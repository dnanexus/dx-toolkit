#!/usr/bin/env python2.7
#
# Copyright (C) 2013 DNAnexus, Inc.
#
# This file is part of dx-toolkit (DNAnexus platform client libraries).
#
#   Licensed under the Apache License, Version 2.0 (the "License"); you may not
#   use this file except in compliance with the License. You may obtain a copy
#   of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
#   WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
#   License for the specific language governing permissions and limitations
#   under the License.

import sys, json

preamble = '''# Do not modify this file by hand.
#
# It is automatically generated by src/api_wrappers/generatePythonAPIWrappers.py.
# (Run make api_wrappers to update it.)

from dxpy import DXHTTPRequest
'''

class_method_template = '''
def {method_name}(input_params={{}}, always_retry={retry}, **kwargs):
    return DXHTTPRequest('{route}', input_params, always_retry=always_retry, **kwargs)
'''

object_method_template = '''
def {method_name}(object_id, input_params={{}}, always_retry={retry}, **kwargs):
    return DXHTTPRequest('/%s/{method_route}' % object_id, input_params, always_retry=always_retry, **kwargs)
'''

app_object_method_template = '''
def {method_name}(app_name_or_id, alias=None, input_params={{}}, always_retry={retry}, **kwargs):
    fully_qualified_version = app_name_or_id + (('/' + alias) if alias else '')
    return DXHTTPRequest('/%s/{method_route}' % fully_qualified_version, input_params, always_retry=always_retry, **kwargs)
'''

print preamble

for method in json.loads(sys.stdin.read()):
    route, signature, opts = method
    method_name = signature.split("(")[0]
    retry = "True" if (opts['retryable']) else "False"
    if (opts['objectMethod']):
        root, oid_route, method_route = route.split("/")
        if oid_route == 'app-xxxx':
            print app_object_method_template.format(method_name=method_name, method_route=method_route, retry=retry)
        else:
            print object_method_template.format(method_name=method_name, method_route=method_route, retry=retry)
    else:
        print class_method_template.format(method_name=method_name, route=route, retry=retry)
